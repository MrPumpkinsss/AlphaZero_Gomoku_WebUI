<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>五子棋 - 人类 vs AI</title>
    <style>
        body { text-align: center; font-family: Arial; }
        #board { display: grid; margin: 20px auto; }
        .cell {
            width: 40px;
            height: 40px;
            border: 1px solid #555;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>人类 vs AI 五子棋</h1>
    <div id="board"></div>
    <p id="status"></p>

    <script>
        const width = {{ width }};
        const height = {{ height }};
        const boardElement = document.getElementById("board");
        const status = document.getElementById("status");

        boardElement.style.gridTemplateColumns = `repeat(${width}, 40px)`;

        let board = Array(width * height).fill('');

        function render() {
            boardElement.innerHTML = '';
            board.forEach((cell, idx) => {
                const div = document.createElement('div');
                div.className = 'cell';
                div.innerText = cell;
                div.onclick = () => handleClick(idx);
                boardElement.appendChild(div);
            });
        }

        function handleClick(idx) {
            if (board[idx] !== '') return;
            const row = Math.floor(idx / width);
            const col = idx % width;

            fetch('/play', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ row, col })
            })
            .then(res => res.json())
            .then(data => {
                if (data.status === 'invalid') {
                    status.innerText = '无效的落子';
                } else {
                    board[idx] = '●';
                    if (data.status === 'win') {
                        status.innerText = '你赢了！';
                        render();
                        return;
                    }
                    const [ai_row, ai_col] = data.ai_move;
                    board[ai_row * width + ai_col] = '○';
                    if (data.status === 'lose') {
                        status.innerText = '你输了！';
                    } else {
                        status.innerText = '轮到你了';
                    }
                }
                render();
            });
        }

        render();
    </script>
</body>
</html>
